<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JITç¼–è¯‘ä¼˜åŒ–</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <script src="i18n.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        .header { text-align: center; color: white; margin-bottom: 30px; }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .back-btn {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            text-decoration: none;
            margin-bottom: 20px;
        }
        .control-panel { text-align: center; margin-bottom: 30px; }
        .btn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 16px;
            border-radius: 25px;
            cursor: pointer;
            margin: 5px;
        }
        .main-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        .section-title {
            font-size: 1.8em;
            color: #333;
            margin: 30px 0 20px 0;
            padding-bottom: 10px;
            border-bottom: 3px solid #f5576c;
        }
        .compiler-flow {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }
        .flow-step {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            transition: all 0.3s;
            border: 3px solid transparent;
        }
        .flow-step.active {
            border-color: #f5576c;
            background: linear-gradient(135deg, #fff0f5 0%, #fff5f7 100%);
            transform: scale(1.05);
        }
        .flow-icon {
            font-size: 3em;
            margin-bottom: 10px;
        }
        .flow-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }
        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
        }
        .keyword { color: #ff79c6; }
        .type { color: #8be9fd; }
        .method { color: #50fa7b; }
        .comment { color: #6272a4; }
        .optimization-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin: 15px 0;
        }
        .optimization-card h3 {
            margin-bottom: 15px;
            font-size: 1.4em;
        }
        .before-after {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .before-after-box {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }
        .before-after-box h4 {
            color: #f5576c;
            margin-bottom: 10px;
        }
        .hotspot-meter {
            width: 100%;
            height: 30px;
            background: #e9ecef;
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
        }
        .hotspot-fill {
            height: 100%;
            background: linear-gradient(90deg, #ffd33d 0%, #f5576c 100%);
            transition: width 1s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
    
        /* è¨€èªåˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .language-switcher {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        #language-selector {
            padding: 10px 15px;
            border-radius: 25px;
            border: 2px solid white;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 1em;
            cursor: pointer;
            backdrop-filter: blur(10px);
            transition: all 0.3s;
            font-weight: bold;
        }

        #language-selector:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        #language-selector option {
            background: #764ba2;
            color: white;
        }
    </style>
</head>
<body>
    <!-- è¨€èªåˆ‡ã‚Šæ›¿ãˆ -->
    <div class="language-switcher">
        <select id="language-selector" onchange="window.langSwitcher.changeLanguage(this.value)">
            <option value="zh">ä¸­æ–‡</option>
            <option value="ja">æ—¥æœ¬èª</option>
            <option value="en">English</option>
        </select>
    </div>


    <div class="container">
        <a href="index.html" class="back-btn animate__animated animate__fadeIn">â† è¿”å›ä¸»é¡µ</a>
        <div class="header animate__animated animate__fadeInDown">
            <h1>âš¡ <span data-i18n="jitTitle">JITç¼–è¯‘ä¼˜åŒ–</span></h1>
            <p>å³æ—¶ç¼–è¯‘å™¨çš„é­”æ³• - è®©Javaé£èµ·æ¥</p>
        </div>
        <div class="control-panel animate__animated animate__fadeIn">
            <button class="btn" onclick="demonstrateJIT()">â–¶ï¸ JITæµç¨‹æ¼”ç¤º</button>
            <button class="btn" onclick="demonstrateHotspot()">ğŸ”¥ çƒ­ç‚¹æ£€æµ‹</button>
            <button class="btn" onclick="reset()">ğŸ”„ é‡ç½®</button>
        </div>
        <div class="main-content animate__animated animate__fadeInUp">
            <h2 class="section-title">ğŸ¯ JITç¼–è¯‘æµç¨‹</h2>
            <div class="compiler-flow" id="jitFlow">
                <div class="flow-step" data-step="1">
                    <div class="flow-icon">ğŸ“</div>
                    <div class="flow-title">è§£é‡Šæ‰§è¡Œ</div>
                    <p>åˆå§‹é˜¶æ®µé€è¡Œè§£é‡Šå­—èŠ‚ç </p>
                </div>
                <div class="flow-step" data-step="2">
                    <div class="flow-icon">ğŸ”¥</div>
                    <div class="flow-title">çƒ­ç‚¹æ£€æµ‹</div>
                    <p>ç›‘æ§æ–¹æ³•è°ƒç”¨æ¬¡æ•°</p>
                </div>
                <div class="flow-step" data-step="3">
                    <div class="flow-icon">âš™ï¸</div>
                    <div class="flow-title">ç¼–è¯‘è§¦å‘</div>
                    <p>è¾¾åˆ°é˜ˆå€¼è§¦å‘JITç¼–è¯‘</p>
                </div>
                <div class="flow-step" data-step="4">
                    <div class="flow-icon">ğŸš€</div>
                    <div class="flow-title">æœ¬åœ°ä»£ç </div>
                    <p>æ‰§è¡Œä¼˜åŒ–åçš„æœºå™¨ç </p>
                </div>
            </div>

            <h2 class="section-title">ğŸ”¥ çƒ­ç‚¹ä»£ç æ£€æµ‹</h2>
            <div style="padding: 20px; background: #f8f9fa; border-radius: 15px;">
                <h3>æ–¹æ³•è°ƒç”¨è®¡æ•°å™¨</h3>
                <div class="hotspot-meter">
                    <div class="hotspot-fill" id="hotspotMeter" style="width: 0%;">0%</div>
                </div>
                <p style="text-align: center; margin-top: 10px; color: #666;">
                    é˜ˆå€¼: 10000æ¬¡ (C1ç¼–è¯‘å™¨) / 10000æ¬¡ (C2ç¼–è¯‘å™¨)
                </p>
            </div>

            <h2 class="section-title">ğŸ¨ JITä¼˜åŒ–æŠ€æœ¯</h2>
            <div class="optimization-card">
                <h3>1ï¸âƒ£ æ–¹æ³•å†…è” (Method Inlining)</h3>
                <p>å°†è¢«è°ƒç”¨æ–¹æ³•çš„ä»£ç ç›´æ¥åµŒå…¥åˆ°è°ƒç”¨ç‚¹ï¼Œæ¶ˆé™¤æ–¹æ³•è°ƒç”¨å¼€é”€</p>
                <div class="before-after">
                    <div class="before-after-box">
                        <h4>ä¼˜åŒ–å‰</h4>
                        <div class="code-block" style="margin: 10px 0; padding: 10px; font-size: 0.85em;">
<span class="keyword">int</span> result = <span class="method">add</span>(a, b);

<span class="keyword">int</span> <span class="method">add</span>(<span class="keyword">int</span> x, <span class="keyword">int</span> y) {
    <span class="keyword">return</span> x + y;
}
                        </div>
                    </div>
                    <div class="before-after-box">
                        <h4>ä¼˜åŒ–å âœ…</h4>
                        <div class="code-block" style="margin: 10px 0; padding: 10px; font-size: 0.85em;">
<span class="keyword">int</span> result = a + b;
<span class="comment">// æ–¹æ³•è°ƒç”¨è¢«å†…è”</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="optimization-card">
                <h3>2ï¸âƒ£ é€ƒé€¸åˆ†æ (Escape Analysis)</h3>
                <p>åˆ†æå¯¹è±¡ä½œç”¨åŸŸï¼Œå¦‚æœå¯¹è±¡ä¸ä¼šé€ƒé€¸åˆ°æ–¹æ³•å¤–ï¼Œå¯è¿›è¡Œæ ˆä¸Šåˆ†é…æˆ–æ ‡é‡æ›¿æ¢</p>
                <div class="code-block">
<span class="keyword">public void</span> <span class="method">test</span>() {
    <span class="type">Point</span> p = <span class="keyword">new</span> <span class="type">Point</span>(1, 2);  <span class="comment">// å¯¹è±¡æœªé€ƒé€¸</span>
    <span class="keyword">int</span> sum = p.x + p.y;
    <span class="comment">// JITä¼˜åŒ–: å°†å¯¹è±¡æ‹†è§£ä¸ºå±€éƒ¨å˜é‡ (æ ‡é‡æ›¿æ¢)</span>
    <span class="comment">// int x = 1; int y = 2; int sum = x + y;</span>
}
                </div>
            </div>

            <div class="optimization-card">
                <h3>3ï¸âƒ£ å¾ªç¯ä¼˜åŒ–</h3>
                <p>å¾ªç¯å±•å¼€ã€å¾ªç¯ä¸å˜é‡å¤–æç­‰</p>
                <div class="before-after">
                    <div class="before-after-box">
                        <h4>ä¼˜åŒ–å‰</h4>
                        <div class="code-block" style="margin: 10px 0; padding: 10px; font-size: 0.85em;">
<span class="keyword">for</span>(<span class="keyword">int</span> i=0; i<100; i++) {
    result += i * factor;
}
                        </div>
                    </div>
                    <div class="before-after-box">
                        <h4>å¾ªç¯å±•å¼€ âœ…</h4>
                        <div class="code-block" style="margin: 10px 0; padding: 10px; font-size: 0.85em;">
<span class="keyword">for</span>(<span class="keyword">int</span> i=0; i<100; i+=4) {
    result += i * factor;
    result += (i+1) * factor;
    result += (i+2) * factor;
    result += (i+3) * factor;
}
                        </div>
                    </div>
                </div>
            </div>

            <div class="optimization-card">
                <h3>4ï¸âƒ£ æ­»ä»£ç æ¶ˆé™¤ (Dead Code Elimination)</h3>
                <p>ç§»é™¤æ°¸è¿œä¸ä¼šæ‰§è¡Œçš„ä»£ç </p>
                <div class="code-block">
<span class="keyword">if</span> (<span class="keyword">false</span>) {
    System.out.<span class="method">println</span>(<span class="string">"è¿™æ®µä»£ç ä¼šè¢«JITåˆ é™¤"</span>);
}

<span class="keyword">final int</span> MAX = 100;
<span class="keyword">if</span> (MAX > 200) {  <span class="comment">// æ°¸è¿œä¸ä¼šæ‰§è¡Œï¼Œä¼šè¢«ä¼˜åŒ–æ‰</span>
    doSomething();
}
                </div>
            </div>

            <h2 class="section-title">ğŸ”§ C1ä¸C2ç¼–è¯‘å™¨</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div style="background: linear-gradient(135deg, #40c463 0%, #30a14e 100%); color: white; padding: 25px; border-radius: 15px;">
                    <h3 style="margin-bottom: 15px;">C1 ç¼–è¯‘å™¨ (Client)</h3>
                    <p>â€¢ ç¼–è¯‘é€Ÿåº¦å¿«</p>
                    <p>â€¢ ä¼˜åŒ–ç¨‹åº¦è¾ƒä½</p>
                    <p>â€¢ é€‚åˆå¿«é€Ÿå¯åŠ¨</p>
                    <p>â€¢ è§¦å‘é˜ˆå€¼: 1500æ¬¡</p>
                </div>
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 15px;">
                    <h3 style="margin-bottom: 15px;">C2 ç¼–è¯‘å™¨ (Server)</h3>
                    <p>â€¢ ç¼–è¯‘é€Ÿåº¦è¾ƒæ…¢</p>
                    <p>â€¢ æ·±åº¦ä¼˜åŒ–</p>
                    <p>â€¢ é€‚åˆé•¿æ—¶é—´è¿è¡Œ</p>
                    <p>â€¢ è§¦å‘é˜ˆå€¼: 10000æ¬¡</p>
                </div>
            </div>

            <h2 class="section-title">âš™ï¸ JITç›¸å…³å‚æ•°</h2>
            <div class="code-block">
<span class="comment"># ç¦ç”¨JITç¼–è¯‘ï¼ˆçº¯è§£é‡Šæ‰§è¡Œï¼‰</span>
-Xint

<span class="comment"># åªä½¿ç”¨JITç¼–è¯‘ï¼ˆä¸è§£é‡Šæ‰§è¡Œï¼‰</span>
-Xcomp

<span class="comment"># æ··åˆæ¨¡å¼ï¼ˆé»˜è®¤ï¼‰</span>
-Xmixed

<span class="comment"># æ‰“å°JITç¼–è¯‘ä¿¡æ¯</span>
-XX:+PrintCompilation

<span class="comment"># å…³é—­é€ƒé€¸åˆ†æ</span>
-XX:-DoEscapeAnalysis

<span class="comment"># è®¾ç½®ç¼–è¯‘é˜ˆå€¼</span>
-XX:CompileThreshold=10000

<span class="comment"># ç¦ç”¨åˆ†å±‚ç¼–è¯‘</span>
-XX:-TieredCompilation
            </div>

            <div style="padding: 20px; background: #d1ecf1; border-radius: 10px; border-left: 4px solid #17a2b8; margin: 20px 0;">
                <strong>ğŸ’¡ æœ€ä½³å®è·µï¼š</strong><br>
                â€¢ JITç¼–è¯‘éœ€è¦é¢„çƒ­æ—¶é—´ï¼Œç”Ÿäº§ç¯å¢ƒæ³¨æ„é¢„çƒ­<br>
                â€¢ ä½¿ç”¨JMHè¿›è¡ŒåŸºå‡†æµ‹è¯•æ—¶è¦è¶³å¤Ÿçš„é¢„çƒ­è¿­ä»£<br>
                â€¢ å¾®æœåŠ¡çŸ­ç”Ÿå‘½å‘¨æœŸåœºæ™¯å¯èƒ½æ— æ³•å……åˆ†åˆ©ç”¨JITä¼˜åŒ–<br>
                â€¢ GraalVMæä¾›AOTç¼–è¯‘ï¼Œé€‚åˆå¿«é€Ÿå¯åŠ¨åœºæ™¯
            </div>
        </div>
    </div>
    <script>
        async function demonstrateJIT() {
            const steps = document.querySelectorAll('.flow-step');
            steps.forEach(s => s.classList.remove('active'));

            for(let i = 0; i < steps.length; i++) {
                steps[i].classList.add('active', 'animate__animated', 'animate__bounceIn');
                await sleep(800);
            }
        }

        async function demonstrateHotspot() {
            const meter = document.getElementById('hotspotMeter');
            let count = 0;
            const interval = setInterval(() => {
                count += 500;
                const percent = Math.min((count / 10000) * 100, 100);
                meter.style.width = percent + '%';
                meter.textContent = count + ' æ¬¡';

                if(count >= 10000) {
                    clearInterval(interval);
                    meter.textContent = 'ğŸ”¥ è§¦å‘JITç¼–è¯‘ï¼';
                }
            }, 100);
        }

        function reset() {
            document.querySelectorAll('.flow-step').forEach(s => {
                s.classList.remove('active', 'animate__animated', 'animate__bounceIn');
            });
            document.getElementById('hotspotMeter').style.width = '0%';
            document.getElementById('hotspotMeter').textContent = '0%';
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        window.addEventListener('load', () => {
            setTimeout(() => demonstrateJIT(), 1000);
        });
    </script>
</body>
</html>